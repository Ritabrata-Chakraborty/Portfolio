{{ $ := .root }}
{{ $page := .page }}
{{ $columns := $page.Params.design.columns | default "2" }}

<div class="col-12 {{if ne $columns "1"}}col-lg-8{{end}}">
  {{ with $page.Content }}{{ . }}{{ end }}

  {{ if $page.Params.experience }}
  <div class="row experience">
    {{ range $page.Params.experience }}
    <div class="col-auto text-center flex-column d-none d-sm-flex">
      <div class="row h-50">
        <div class="col {{if gt (len $page.Params.experience) 1}}border-right{{end}}">&nbsp;</div>
        <div class="col">&nbsp;</div>
      </div>
      <div class="m-2">
        <span class="badge badge-pill border exp-fill">&nbsp;</span>
      </div>
      <div class="row h-50">
        <div class="col {{if gt (len $page.Params.experience) 1}}border-right{{end}}">&nbsp;</div>
        <div class="col">&nbsp;</div>
      </div>
    </div>
    <div class="col py-2">
      <div class="card">
        <div class="card-body">

          {{ $company := .company }}
          {{ with .company_logo }}
          <div class="section-subheading card-title exp-company text-muted my-0">
            <img src="{{ printf "media/icons/brands/%s.svg" . | relURL }}" alt="{{ $company }}" class="experience-logo">
            {{ $company }}
          </div>
          {{ else }}
          <div class="section-subheading card-title exp-company text-muted my-0">{{ $company }}</div>
          {{ end }}

          <div class="section-subheading card-title exp-title text-muted my-0">{{ .title | markdownify | emojify }}</div>
          
          <!-- Custom supervisor field -->
          {{ if .supervisor }}
          <div class="card-text exp-supervisor">
            {{ if .supervisor_url }}
            <i class="fas fa-user-graduate pub-icon" aria-hidden="true"></i>
            <strong>Supervisor:</strong> <a href="{{ .supervisor_url }}" target="_blank" rel="noopener">{{ .supervisor }}</a>
            {{ else }}
            <i class="fas fa-user-graduate pub-icon" aria-hidden="true"></i>
            <strong>Supervisor:</strong> {{ .supervisor }}
            {{ end }}
          </div>
          {{ end }}
          
          {{ with .location }}
          <div class="card-text exp-meta">
            <i class="fas fa-map-marker-alt exp-meta-icon"></i>
            {{ . }}
          </div>
          {{ end }}

          <div class="card-text exp-meta">
            <i class="fas fa-calendar exp-meta-icon"></i>
            {{ (time .date_start).Format ($page.Params.date_format | default "January 2006") }}
            {{- if .date_end }} – {{ (time .date_end).Format ($page.Params.date_format | default "January 2006") }}
            {{- else }} – {{ i18n "present" | default "Present" }}{{- end }}
          </div>

          {{ with .description }}<div class="card-text">{{ . | markdownify | emojify }}</div>{{ end }}

        </div>
      </div>
    </div>
    {{ end }}
  </div>
  {{ end }}
</div> 